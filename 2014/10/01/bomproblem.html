<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="author" content="Yuta Ide"><meta name="description" content="Djangoのinclude機能を利用したときに謎の空テキストが表示される現象の原因と対策"><title>ideyuta.com&mdash;Djangoのinclude機能を利用したときに謎の空テキストが表示される現象の原因と対策</title><link href="/favicon.png" rel="icon"><link href="http://fonts.googleapis.com/earlyaccess/notosansjapanese.css" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/css/base.css"><script>var ide = {};</script><script src="/js/base.js"></script></head><body><div class="Wrapper"><div class="Header"><h1><a href="/"><img src="/images/ide.svg" width="32" height="32"></a></h1><div class="pageResponse"><div class="BtnGroup"><a data-url="http://ideyuta.com/" href="https://twitter.com/intent/tweet?original_referer=http://ideyuta.com/&amp;text=ideyuta.com - http://ideyuta.com" class="tweet btn f"><i class="znicon-twitter"></i><span class="count"></span></a><a data-url="http://ideyuta.com/" href="javascript: void(0);" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=http://ideyuta.com/&amp;t=ideyuta.com', 'share', 'width=500, height=280');" class="like btn f"><i class="znicon-facebook"></i><span class="count"></span></a><a data-url="http://ideyuta.com/" href="javascript: void(0);" onclick="window.open('http://b.hatena.ne.jp/entry/add/http://ideyuta.com/', 'share', 'width=750, height=600');" class="hatebu btn f"><img src="http://b.st-hatena.com/images/entry-button/button-only@2x.png"><span class="count"></span></a></div></div></div><div class="PostDetail"><div class="PostMeta"><h2 class="title">Djangoのinclude機能を利用したときに謎の空テキストが表示される現象の原因と対策</h2><div class="Meta"><div class="date"><p>2014-10-01</p></div><div class="categories"><ul><li><a href="/categories/dev/">dev</a></li></ul></div></div></div><div class="PostContent"> <p>Djangoのinclude機能を使ったときに謎の空テキストが表示される現象が起こったのでその原因と対処方法をまとめておきます。</p>
<p>##現象</p>
<p>変換前</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"hoge"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">&#123;% include 'fuga.html' %&#125;</span><br></pre></td></tr></table></figure>
<p>変換後</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"hoge"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">"</span><br><span class="line"></span><br><span class="line">"</span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"fuga"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>##原因<br>BOMというのが原因らしい。BOM<span class="super">※1</span>はByte Order Markといって、Unicode形式で書かれたファイルですよっていうことを表す<span class="super">※2</span>らしい。こいつがファイルの一番始めにくっついていると、includeしたときに空テキストとして変換されてしまってぶっ壊れる。<br>どうやらDjangoに限ったことではなくて、PHPとかでも起こる模様。</p>
<div class="SideMatter" style="top:1155px;"><ul><br><li><br><p>※1</p><br><a href="http://e-words.jp/w/BOM.html" target="_blank" rel="external">e-Words:BOMとは</a><br></li><br><li><br><p>※2</p><br><a href="http://q.hatena.ne.jp/1269678207" target="_blank" rel="external">文字コードのUTF-8について、BOM無しと、BOM付き、というのがあったのですが、具体的に、どう異なるのでしょうか？</a><br></li><br></ul></div>

<p>##対処方法<br>対処方法としては、単純にvimでバイナリモードで該当ファイルを開いてBOM部分を消すだけでOK。</p>
<p>1. まずは該当ファイルをバイナリモードで開く。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">vim</span> -<span class="keyword">b</span> <span class="built_in">index</span>.html</span><br></pre></td></tr></table></figure>
<p>2. 以下のような感じで挿入されているBOM（<code>&lt;U+FEFF&gt;</code>部分）を削除</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">U+FEFF</span>&gt;</span><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"test"</span>&gt;</span> ... <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>これできれいさっぱり空テキストが消えます！</p>
<p>##BOM付きのファイルを探す方法<br>他にも問題のあるファイルがあるんじゃねえか？ってことでBOM付きのファイルを探すコマンド<span class="super">※3</span>を探しました（<a href="https://twitter.com/moqada" target="_blank" rel="external">@moqada</a>さんが）。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find . -type f -name '*.html' -exec file &#123;&#125; + | grep "(with BOM)"</span><br></pre></td></tr></table></figure>
<p>これで安心ですな。</p>
<div class="SideMatter" style="top:1965px;"><ul><br><li><br><p>※3</p><br><a href="http://qiita.com/tailak/items/8ba2e738555f8596d3e3" target="_blank" rel="external">Qiita:BOM付きUTF-8のファイルを探す</a><br></li><br></ul></div>
</div><div class="Share"><ul><li data-url="http://ideyuta.com/2014/10/01/bomproblem.html" class="tweet"><a href="https://twitter.com/intent/tweet?original_referer=http://ideyuta.com/2014/10/01/bomproblem.html&amp;text=Djangoのinclude機能を利用したときに謎の空テキストが表示される現象の原因と対策 ｜ ideyuta.com http://ideyuta.com/2014/10/01/bomproblem.html" class="btn"><i class="znicon-twitter"></i><span class="count"></span></a></li><li data-url="http://ideyuta.com/2014/10/01/bomproblem.html" class="like"><a href="javascript: void(0);" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=http://ideyuta.com/2014/10/01/bomproblem.html&amp;t=Djangoのinclude機能を利用したときに謎の空テキストが表示される現象の原因と対策', 'share', 'width=500, height=280');" class="btn"><i class="znicon-facebook"></i><span class="count"></span></a></li><li data-url="http://ideyuta.com/2014/10/01/bomproblem.html" class="hatebu"><a href="javascript: void(0);" onclick="window.open('http://b.hatena.ne.jp/entry/add/http://ideyuta.com/2014/10/01/bomproblem.html', 'share', 'width=750, height=600');" class="btn"><img src="http://b.st-hatena.com/images/entry-button/button-only@2x.png"><span class="count"></span></a></li></ul></div></div></div><div class="Footer"><div class="Profile"><div class="thumb"><img src="/images/ideyuta.jpg"></div><div class="bio"><h4 class="name">井出 優太</h4><p class="summary">1988年静岡県生まれ。多摩美術大学大学院 情報デザイン領域 経験デザイン 修了。株式会社カンム所属。</p><div class="social BtnGroup"><a href="https://twitter.com/_ideyuta" class="btn f twitter"><i class="znicon-twitter"></i><span>Twitter</span></a><a href="https://www.facebook.com/XA2007.055" class="btn f facebook"><i class="znicon-facebook"></i><span>Facebook</span></a><a href="https://github.com/ideyuta" class="btn f github"><i class="znicon-github"></i><span>GitHub</span></a><a href="mailto:ide.yuta@gmail.com" class="btn f"><i class="znicon-mail"></i><span>Mail</span></a></div></div></div><div class="Copyright"><p>&copy; 2015 ideyuta.com</p></div></div></body></html>